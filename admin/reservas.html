<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Reservas - Admin Hotel Dubai</title>
    <link rel="icon" type="image/x-icon" href="../img/logo.jpg">
    <link rel="stylesheet" href="../css/design-system.css">
    <link rel="stylesheet" href="../css/animations.css">
    <style>
        body {
            margin: 0;
            background: var(--gray-100);
        }

        .admin-layout {
            display: flex;
            min-height: 100vh;
        }

        .admin-sidebar {
            width: 260px;
            background: var(--dark);
            color: white;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .admin-main {
            margin-left: 260px;
            flex: 1;
            padding: 2rem;
        }

        .admin-header {
            background: white;
            padding: 1.5rem 2rem;
            margin: -2rem -2rem 2rem;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            text-align: center;
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }

        .admin-logo img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 1rem;
        }

        .admin-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s;
        }

        .admin-nav a:hover,
        .admin-nav a.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .filters {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: end;
        }

        .content-section {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 2px solid var(--gray-200);
            color: var(--gray-700);
            font-weight: 600;
            font-size: 0.875rem;
        }

        td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.875rem;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }

        .actions {
            display: flex;
            gap: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray-600);
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
    </style>
</head>

<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <img src="../img/logo.jpg" alt="Hotel Dubai">
                <h2>Hotel Dubai</h2>
                <p style="font-size: 0.85rem; opacity: 0.7; margin: 0;">Panel Administrativo</p>
            </div>

            <nav class="admin-nav">
                <a href="dashboard.html">
                    <span>üìä</span> Dashboard
                </a>
                <a href="reservas.html" class="active">
                    <span>üìÖ</span> Reservas
                </a>
                <a href="mensajes.html">
                    <span>‚úâÔ∏è</span> Mensajes
                </a>
                <a href="../index.html" target="_blank">
                    <span>üåê</span> Ver Sitio Web
                </a>
                <a href="#" onclick="adminPanel.logout(); return false;"
                    style="margin-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1.5rem;">
                    <span>üö™</span> Cerrar Sesi√≥n
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="admin-header">
                <div>
                    <h1 style="margin: 0; font-size: 1.75rem;">Gesti√≥n de Reservas</h1>
                    <p style="margin: 0.25rem 0 0; color: var(--gray-600);">Administra todas las reservas del hotel</p>
                </div>
                <div>
                    <button onclick="exportReservations()" class="btn btn-secondary btn-sm">
                        üì• Exportar CSV
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters">
                <div class="form-group" style="margin: 0; min-width: 200px;">
                    <label class="form-label" style="margin-bottom: 0.5rem;">Estado</label>
                    <select id="filterStatus" class="form-control" onchange="filterReservations()">
                        <option value="all">Todos</option>
                        <option value="pending">Pendientes</option>
                        <option value="confirmed">Confirmadas</option>
                        <option value="cancelled">Canceladas</option>
                        <option value="completed">Completadas</option>
                    </select>
                </div>

                <div class="form-group" style="margin: 0; min-width: 200px;">
                    <label class="form-label" style="margin-bottom: 0.5rem;">Habitaci√≥n</label>
                    <select id="filterRoom" class="form-control" onchange="filterReservations()">
                        <option value="all">Todas</option>
                        <option value="sencilla">Sencilla</option>
                        <option value="doble">Doble</option>
                        <option value="familiar">Familiar</option>
                    </select>
                </div>

                <div class="form-group" style="margin: 0; flex: 1; min-width: 200px;">
                    <label class="form-label" style="margin-bottom: 0.5rem;">Buscar</label>
                    <input type="text" id="searchInput" class="form-control" placeholder="Nombre, email, tel√©fono..."
                        oninput="filterReservations()">
                </div>
            </div>

            <!-- Tabla de Reservas -->
            <div class="content-section">
                <div id="reservationsTable">
                    <!-- Se llenar√° con JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <script src="../js/admin.js"></script>
    <script>
        let allReservations = [];

        // Cargar reservas
        function loadReservations() {
            allReservations = adminPanel.getReservations().reverse();
            renderReservations(allReservations);
        }

        // Renderizar tabla
        function renderReservations(reservations) {
            const container = document.getElementById('reservationsTable');

            if (reservations.length === 0) {
                container.innerHTML = `
          <div class="empty-state">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
              <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"/>
            </svg>
            <h3>No hay reservas</h3>
            <p>Las reservas aparecer√°n aqu√≠ cuando los clientes hagan reservas desde el sitio web.</p>
          </div>
        `;
                return;
            }

            let html = `
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Cliente</th>
              <th>Contacto</th>
              <th>Habitaci√≥n</th>
              <th>Check-in</th>
              <th>Check-out</th>
              <th>Hu√©spedes</th>
              <th>Total</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
      `;

            reservations.forEach(r => {
                html += `
          <tr>
            <td><strong>#${r.id}</strong></td>
            <td>${r.name}</td>
            <td>
              <div style="font-size: 0.8rem;">
                üìß ${r.email}<br>
                üìû ${r.phone}
              </div>
            </td>
            <td>${adminPanel.getStatusBadge(r.roomType).replace('badge', 'badge badge-info')}</td>
            <td>${adminPanel.formatDateShort(r.checkin)}</td>
            <td>${adminPanel.formatDateShort(r.checkout)}</td>
            <td>${r.guests}</td>
            <td><strong style="color: var(--secondary);">S/ ${r.total}</strong></td>
            <td>${adminPanel.getStatusBadge(r.status)}</td>
            <td>
              <div class="actions">
                <button onclick="viewReservation(${r.id})" class="btn btn-sm btn-primary" title="Ver detalles">
                  üëÅÔ∏è
                </button>
                ${r.status === 'pending' ? `
                  <button onclick="updateStatus(${r.id}, 'confirmed')" class="btn btn-sm" style="background: var(--success); color: white;" title="Confirmar">
                    ‚úì
                  </button>
                  <button onclick="updateStatus(${r.id}, 'cancelled')" class="btn btn-sm" style="background: var(--danger); color: white;" title="Cancelar">
                    ‚úó
                  </button>
                ` : ''}
                <button onclick="deleteReservation(${r.id})" class="btn btn-sm" style="background: var(--danger); color: white;" title="Eliminar">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Filtrar reservas
        function filterReservations() {
            const status = document.getElementById('filterStatus').value;
            const room = document.getElementById('filterRoom').value;
            const search = document.getElementById('searchInput').value.toLowerCase();

            let filtered = allReservations;

            if (status !== 'all') {
                filtered = filtered.filter(r => r.status === status);
            }

            if (room !== 'all') {
                filtered = filtered.filter(r => r.roomType === room);
            }

            if (search) {
                filtered = filtered.filter(r =>
                    r.name.toLowerCase().includes(search) ||
                    r.email.toLowerCase().includes(search) ||
                    r.phone.includes(search)
                );
            }

            renderReservations(filtered);
        }

        // Ver detalles
        function viewReservation(id) {
            const reservation = allReservations.find(r => r.id === id);
            if (!reservation) return;

            const content = `
        <h2 style="margin-bottom: 1.5rem;">Detalles de Reserva #${reservation.id}</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
          <div>
            <h3 style="color: var(--primary); margin-bottom: 1rem;">Informaci√≥n del Cliente</h3>
            <div style="line-height: 2;">
              <div><strong>Nombre:</strong> ${reservation.name}</div>
              <div><strong>Email:</strong> ${reservation.email}</div>
              <div><strong>Tel√©fono:</strong> ${reservation.phone}</div>
            </div>
          </div>
          
          <div>
            <h3 style="color: var(--primary); margin-bottom: 1rem;">Detalles de Reserva</h3>
            <div style="line-height: 2;">
              <div><strong>Habitaci√≥n:</strong> ${reservation.roomType}</div>
              <div><strong>Check-in:</strong> ${adminPanel.formatDateShort(reservation.checkin)}</div>
              <div><strong>Check-out:</strong> ${adminPanel.formatDateShort(reservation.checkout)}</div>
              <div><strong>Hu√©spedes:</strong> ${reservation.guests}</div>
              <div><strong>Noches:</strong> ${reservation.nights}</div>
              <div><strong>Total:</strong> <span style="color: var(--secondary); font-size: 1.5rem; font-weight: 700;">S/ ${reservation.total}</span></div>
            </div>
          </div>
        </div>
        
        ${reservation.requests ? `
          <div style="margin-top: 2rem;">
            <h3 style="color: var(--primary); margin-bottom: 1rem;">Solicitudes Especiales</h3>
            <div style="background: var(--gray-100); padding: 1rem; border-radius: var(--radius);">
              ${reservation.requests}
            </div>
          </div>
        ` : ''}
        
        <div style="margin-top: 2rem;">
          <h3 style="color: var(--primary); margin-bottom: 1rem;">Estado</h3>
          <div>${adminPanel.getStatusBadge(reservation.status)}</div>
        </div>
        
        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--gray-200);">
          <small style="color: var(--gray-600);">
            Creada: ${adminPanel.formatDate(reservation.createdAt)}
          </small>
        </div>
      `;

            window.hotelDubai.createModal(content);
        }

        // Actualizar estado
        function updateStatus(id, newStatus) {
            if (adminPanel.updateReservationStatus(id, newStatus)) {
                adminPanel.showAdminNotification('Estado actualizado correctamente', 'success');
                loadReservations();
                filterReservations();
            }
        }

        // Eliminar reserva
        function deleteReservation(id) {
            if (adminPanel.deleteReservation(id)) {
                adminPanel.showAdminNotification('Reserva eliminada', 'success');
                loadReservations();
                filterReservations();
            }
        }

        // Exportar a CSV
        function exportReservations() {
            const data = allReservations.map(r => ({
                ID: r.id,
                Nombre: r.name,
                Email: r.email,
                Telefono: r.phone,
                Habitacion: r.roomType,
                CheckIn: r.checkin,
                CheckOut: r.checkout,
                Huespedes: r.guests,
                Noches: r.nights,
                Total: r.total,
                Estado: r.status,
                Solicitudes: r.requests || '',
                Fecha: r.createdAt
            }));

            adminPanel.exportToCSV(data, 'reservas-hotel-dubai.csv');
        }

        // Inicializar
        loadReservations();
    </script>
</body>

</html>